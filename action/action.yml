name: Action para crear imagen y tagearla

inputs:
 tag:
  default: latest

runs:
 using: "composite"
 steps:
 - name: Extraer version
   id: version
   run: |
    VERSION=$(jq -r '.version' package.json)
    echo "VERSION=$VERSION" >> $GITHUB_ENV
    echo "app_version=$VERSION" >> $GITHUB_OUTPUT
   shell: bash

 - name: Extraer nombre
   id: nombre
   run: |
    NOMBRE=$(jq -r '.name' package.json)
    echo "NOMBRE=$NOMBRE" >> $GITHUB_ENV
    echo "app_name=$NOMBRE" >> $GITHUB_OUTPUT

 - name: Login DockerHub
   uses: docker/login-action@v2
   with:
    username: ${{secrets.DOCKERHUB_USERNAME}}
    password: ${{secrets.DOCKERHUB_PASS}}

 - name: Nombre tageado de la imagen
   id: nombre_imagen
   run: |
    NOMBRE_IMAGEN="${{secrets.DOCKERHUB_USERNAME}}/${{steps.nombre.outputs.app_name}}:${{steps.version.outputs.app_version}}"
    echo "image_name=$NOMBRE_IMAGEN" >> $GITHUB_OUTPUT
   shell: bash

outputs:
 image_name: ${{steps.nombre_imagen.outputs.image_name}}

 
